{"ast":null,"code":"import axios from'axios';import{useContext,useEffect}from'react';import{URLContext}from'../contexts/Url';import cheerio from'cheerio';import styles from'../styles/PluginContent.module.css';import Welcome from'./Welcome';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var PluginContent=function PluginContent(){// const pluginUrl = '/apps/default';\nvar _useContext=useContext(URLContext),url=_useContext.url;useEffect(function(){if(!url)return;var elRoot=document.getElementById('zc-plugin-root');var reProtocol=/^https?:\\/\\//;var oURL=new URL(reProtocol.test(url)?url:'http://'+url);var prefixLink=function prefixLink(url,oURL){var mimeType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'text/html';var ret=reProtocol.test(url)?url:\"\".concat(oURL.origin).concat(url);return\"/proxy?url=\".concat(ret,\"&mimeType=\").concat(mimeType);};axios.get(prefixLink(oURL.toString())).then(function(res){var $=cheerio.load(res.data);// append stylesheet\n$(\"link[rel=\\\"stylesheet\\\"]\").each(function(){var _this=this;var link=document.createElement('link');Object.keys(this.attribs).forEach(function(attr){return link.setAttribute(attr,_this.attribs[attr]);});link.setAttribute('href',prefixLink(this.attribs.href,oURL,'text/css'));link.setAttribute('data-plugin-res',true);$(this).remove();document.head.prepend(link);});// append scripts\n$('script').each(function(){var _this2=this;var script=document.createElement('script');Object.keys(this.attribs).forEach(function(attr){return script.setAttribute(attr,_this2.attribs[attr]);});if(script.src){script.setAttribute('src',prefixLink(this.attribs.src,oURL,'application/javascript'));}else{script.innerText=$(this).html();}$(this).remove();script.setAttribute('data-plugin-res',true);document.body.appendChild(script);});elRoot.innerHTML=$('body').html();}).catch(function(e){elRoot.innerHTML=\"Failed to Load \".concat(url,\" Plugin: \").concat(e.message);});return function(){elRoot.innerHTML='';document.querySelectorAll('[data-plugin-res]').forEach(function(node){return node.remove();});};},[url]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"section\",{className:styles.container,children:/*#__PURE__*/_jsx(\"div\",{id:\"zc-plugin-root\",children:\"Loading...\"})}),!url&&/*#__PURE__*/_jsx(Welcome,{})]});};","map":{"version":3,"sources":["/home/samuel/Documents/Zuri project/zc_main/zc_frontend/src/components/PluginContent.js"],"names":["axios","useContext","useEffect","URLContext","cheerio","styles","Welcome","PluginContent","url","elRoot","document","getElementById","reProtocol","oURL","URL","test","prefixLink","mimeType","ret","origin","get","toString","then","res","$","load","data","each","link","createElement","Object","keys","attribs","forEach","attr","setAttribute","href","remove","head","prepend","script","src","innerText","html","body","appendChild","innerHTML","catch","e","message","querySelectorAll","node","container"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport { useContext, useEffect } from 'react'\nimport { URLContext } from '../contexts/Url'\nimport cheerio from 'cheerio'\n\nimport styles from '../styles/PluginContent.module.css'\nimport Welcome from './Welcome'\n\nexport const PluginContent = () => {\n  // const pluginUrl = '/apps/default';\n  const { url } = useContext(URLContext)\n\n  useEffect(() => {\n    if (!url) return\n\n    const elRoot = document.getElementById('zc-plugin-root')\n    const reProtocol = /^https?:\\/\\//\n    const oURL = new URL(reProtocol.test(url) ? url : 'http://' + url)\n    const prefixLink = (url, oURL, mimeType = 'text/html') => {\n      let ret = reProtocol.test(url) ? url : `${oURL.origin}${url}`\n      return `/proxy?url=${ret}&mimeType=${mimeType}`\n    }\n\n    axios\n      .get(prefixLink(oURL.toString()))\n      .then((res) => {\n        const $ = cheerio.load(res.data)\n\n        // append stylesheet\n        $(`link[rel=\"stylesheet\"]`).each(function () {\n          const link = document.createElement('link')\n          Object.keys(this.attribs).forEach((attr) =>\n            link.setAttribute(attr, this.attribs[attr])\n          )\n          link.setAttribute(\n            'href',\n            prefixLink(this.attribs.href, oURL, 'text/css')\n          )\n          link.setAttribute('data-plugin-res', true)\n          $(this).remove()\n          document.head.prepend(link)\n        })\n\n        // append scripts\n        $('script').each(function () {\n          const script = document.createElement('script')\n          Object.keys(this.attribs).forEach((attr) =>\n            script.setAttribute(attr, this.attribs[attr])\n          )\n          if (script.src) {\n            script.setAttribute(\n              'src',\n              prefixLink(this.attribs.src, oURL, 'application/javascript')\n            )\n          } else {\n            script.innerText = $(this).html()\n          }\n          $(this).remove()\n          script.setAttribute('data-plugin-res', true)\n          document.body.appendChild(script)\n        })\n        elRoot.innerHTML = $('body').html()\n      })\n      .catch((e) => {\n        elRoot.innerHTML = `Failed to Load ${url} Plugin: ${e.message}`\n      })\n    return () => {\n      elRoot.innerHTML = ''\n      document\n        .querySelectorAll('[data-plugin-res]')\n        .forEach((node) => node.remove())\n    }\n  }, [url])\n\n  return (\n    <>\n      <section className={styles.container}>\n        <div id=\"zc-plugin-root\">Loading...</div>\n      </section>\n      {!url && <Welcome />}\n    </>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}